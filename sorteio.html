<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sorteio - Amigo Secreto</title>
  <link rel="stylesheet" href="style2.css">
</head>
<body>
  <div class="container">
    <h1>Painel do Sorteio</h1>
    <div id="adminAuth">
      <label class="label">Senha de administrador</label>
      <input id="senhaAdmin" type="password" placeholder="Senha do admin">
      <button id="btnEntrar">Entrar</button>
    </div>
    <div id="painel" style="display:none">
      <h2>Participantes</h2>
      <div class="participants-grid" id="listaParticipantes"></div>
      <button id="btnSortear">Realizar Sorteio</button>
      <button id="btnLimpar" style="margin-top:8px;background:linear-gradient(135deg,#ff8a7a,#ffb37a)">Limpar dados</button>
    </div>
  </div>

  <script type="module">
    import { db } from "./firebase-config.js";
    import { ref, get, set } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

    const ADMIN_PW = 'admin123';
    const btnEntrar = document.getElementById('btnEntrar');
    const painel = document.getElementById('painel');
    const lista = document.getElementById('listaParticipantes');

    btnEntrar.onclick = async ()=>{
      const v = document.getElementById('senhaAdmin').value.trim();
      if(v!==ADMIN_PW){alert('Senha incorreta');return}
      document.getElementById('adminAuth').style.display='none';
      painel.style.display='block';
      const snap = await get(ref(db,'participantes'));
      const data = snap.exists()?Object.values(snap.val()):[];
      lista.innerHTML='';
      data.forEach(p=>{
        const d = document.createElement('div');
        d.className='participant';
        d.innerHTML=`<img src="${p.avatar}"><div class="participant-name">${p.nome}</div>`;
        lista.appendChild(d);
      });
    };

    document.getElementById('btnSortear').onclick = async ()=>{
      const snap = await get(ref(db,'participantes'));
      const data = snap.exists()?Object.values(snap.val()):[];
      if(data.length<2){alert('Pelo menos 2 participantes necessÃ¡rios');return}
      const shuffled = [...data].sort(()=>Math.random()-0.5);
      const resultado = [];
      for(let i=0;i<data.length;i++){
        const de = data[i];
        const para = shuffled[(i+1)%shuffled.length];
        resultado.push({deNome:de.nome, deAvatar:de.avatar, paraNome:para.nome, paraAvatar:para.avatar});
      }
      await set(ref(db,'resultado'),resultado);
      alert('Sorteio salvo');
    };

    document.getElementById('btnLimpar').onclick = async ()=>{
      await set(ref(db,'participantes'),null);
      await set(ref(db,'resultado'),null);
      alert('Dados limpos');
      lista.innerHTML='';
    };
  </script>
</body>
</html>
